# 白皮書導讀

這篇論文所使用的電腦技術一點都不新、完全是一二十年前的電腦科學技術，但這篇論文中內容所提到的概念、卻是前所未見的，甚至可以說是驚為天人的。

針對比特幣論文需要了解的是他所闡明、結合的技術有哪些。

* 點對點技術\(P2P\)
* 數字簽名\(Digital Signature\)
* 雙重支付\(Double-Spending\)
* 時間戳\(Timestamp\)
* 工作量證明\(PoW\)
* **遵循最長的鏈為真實帳本**

我知道看完這幾行感覺會跟沒看一樣，就算畫上重點也還是一樣；  
所以我們用更好理解的方式，用這張圖**架構**出了我們需要如何理解比特幣背後運作的方式。

![&#x6211;&#x6240;&#x8A8D;&#x70BA;....&#x4E86;&#x89E3;&#x6BD4;&#x7279;&#x5E63;&#x7684;&#x67B6;&#x69CB;&#x5716;](.gitbook/assets/da-gang-chu-shi-jia-gou.jpg)

## 

## P2P網路架構

BTC是一種基於互聯網的網路\(internet\) + 點對點\(P2P\)底層架構。

所謂的P2P指得是加入網路中所有的計算機均互相對等關係。節點與節點之間是平等的，沒有特殊性。網路節點間以一種"扁平"\(flatting\) 的網狀結構分布著。



## 數位簽章\(Digital Signature\)

首先我們先提提有關**數位簽章**\(Digital Signature\)；

**加密貨幣**\(Cryptocurrency\)是來自於密碼學與貨幣作結合而生。而不管是比特幣還是信用卡或是你的銀行帳戶，有太多地方都涉及加密學了加密的種類有很多，這邊要提的是[**SHA256**](https://baike.baidu.com/item/SHA256)。

> #### 首先，你不一定需要完全了解BTC運作原理就好比你不知道信用卡怎麼加密你依舊可以使用這項科技。

#### 

#### 把時空拉回至人類開始交易的行為，一開始的方式是什麼？

是價值的轉移、或是說貨幣的轉移，當我們發生轉移時往往是將交易的過程與紀錄寫下來，  
而寫上去、記錄這些過程的地方我們常稱作**帳本**\(Ledger\)。

當記帳完成後我們會如何? 我們會**簽上自己的名字，代表交易完成或者同意。**

同樣道理，我們可以將比特幣在Peer-to-peer之間的轉移、視為寫入進一個共同維護的巨型帳本，而確認交易的轉移成功與否我們需要採用數位簽章\(Digital Signature\)來代表跟手寫簽名一樣的效力。

現在你能了解需要設計”數位簽章”的目的了，接下來得說說它是如何而來。

![](.gitbook/assets/photo_2018-08-07_11-58-45.jpg)

![](.gitbook/assets/btc-qian-ming.gif)

## 公鑰 & 私鑰

在比特幣的區塊鏈網路中，每個人都可以隨機產生出自己的**公鑰\(Public Key\)**、**私鑰\(Private Key\)**；

**公鑰**相當於收件地址、可以像QR Code一樣展示給大家讓大家傳送BTC給你；所以公鑰可以意味著你的收款地址；**私鑰**則代表你的個人帳戶密碼與隱私、是個至關重要的資料數字，因為它跟你的數位簽章\(Digital Signature\)有關。

#### 而整體的加密過程與數位簽章彼此的關係函式就像是

$$
簽名( 信息 ,   Private Key ) =>  Signature
$$

$$
驗證 ( 信息, Signature , Public Key)  => 正確 / 錯誤
$$

會利用到所謂的SHA256函式加密，每筆你要傳送的**資料、資訊、交易紀錄\(Message\)**，搭配你的私鑰進行SHA256加密形成數位簽章。

這意味著，每次**傳送資料的不同**、你所**產出的”數位簽章”**也會不同。

而整筆函式的運作與加密，是**不可反向推倒回去**的，原因牽涉到加密學。你有興趣的話極度建議你可以在網路搜尋嘗試了解SHA256以外的其他加密方式。

### 私鑰\(Private Key\)

 比特幣的私鑰（private key），作用相當於金融卡提款或消費的密碼，用於**證明比特幣的所有權**。擁有者必須私密金鑰才可以給交易訊息（最常見的，花費比特幣的訊息）簽名，以證明訊息的發布者是相應位址的所有者，沒有私鑰，就不能給訊息簽名，作為不記名貨幣，網路上無法認得所有權的證據，也就不能使用比特幣，**交易時以網路會以公鑰確認**，**掌握私密金鑰就等於掌握其對應位址中存放的比特幣。**

私鑰的產生是跟  [ECDSA](https://en.bitcoin.it/wiki/ECDSA) ~~橢圓曲線數位簽章演算法~~\(**Elliptic Curve Digital Signature Algorithm**\)有關，細分下去是用 [secp256k1](https://en.bitcoin.it/wiki/Secp256k1)的加密法，私鑰的長度會是 256 bit整數長\(基於0與1\)；如果是16進位制則是32 bytes。

![&#x79C1;&#x9470;&#x7684;&#x4E0D;&#x540C;&#x9762;&#x8C8C;](.gitbook/assets/image%20%2828%29.png)

### 公鑰\(Public Key\)

所以，比特幣系統很智慧的一點：「**就是把一個人的“公鑰”當作這個人的收款賬號（或收款地址）**。」

這樣當你在給別人轉賬時，你輸入了別人的收款賬號——即別人的“**公鑰**”，比特幣系統會自動幫你把這筆款用那個人的“公鑰”鎖定。這樣這筆錢就屬於他了，將來他必須用他的私鑰解鎖，才能使用這筆錢。這樣也就達到了“**只有我的授權才能支付**”這一點。 

> 註：其實公鑰到收款地址還需要做一些轉換，本文為了寫得簡單易懂就忽略這些細節了，  
> 但是**收款賬號**與**公鑰**是有極強的相關性的。

### 私鑰、公鑰、公開地址

#### 

* [https://anders.com/blockchain/public-private-keys/keys.html ](https://anders.com/blockchain/public-private-keys/keys.html%20)
* Private Key & Public Key & Public Address三者之間的關係。 





## 交易\(Transactin\)

**比特幣網路**將**儲存所有的交易歷史**打包在區塊鏈中，比特幣交易就是在區塊鏈帳本上「**記帳**」，通常它由比特幣用戶端協助完成。

付款方需要以自己的**私鑰**對交易進行[數位簽章](https://zh.wikipedia.org/wiki/%E6%95%B8%E4%BD%8D%E7%B0%BD%E7%AB%A0)，**證明所有權**並認可該次交易。比特幣會被記錄在收款方的位址上，交易無需收款方參與，**收款方可以不在線，甚至不存在**，交易的資金支付來源，也就是花費，稱為「輸入」，資金去向，也就是收入，稱為「輸出」。

如有輸入，**輸入必須大於等於輸出**，輸入大於輸出的部分即為**交易手續費**。

**礦工產出交易沒有輸入，只有輸出**，交易記錄會顯示`新生成的比特幣`（`Newly Generated Coins`），除礦工產出交易外，一個輸入必然是另一筆交易的一個輸出，也就是一筆收入必然是其他人的支付。一個輸入沒有成為另一筆交易的輸出時，它是「未花費的」，也就是「帳戶餘額」。收錄此交易的區段被廣播後，此交易就有了「1個確認」。礦工們平均每10分鐘產生一個區段，每一個新區段的誕生會使此交易的確認數加1。當確認數達到6時，通常這筆交易被認為比較安全、難以逆轉。[\[49\]](https://zh.wikipedia.org/wiki/%E6%AF%94%E7%89%B9%E5%B8%81#cite_note-52)。比特幣交易為不可逆，每一筆交易都無法撤銷，商家不必遭到詐騙式的拒付而遭受損失，唯一可以獲得退款的方法，就是請對方再做一筆反向交易，但需要對方的配合。

* [ ] 私鑰=所有權
* [ ] 區塊鏈=儲存所有交易紀錄



## **工作量證明\(PoW\)**

如果只是把交易簡單的組織在一起，是非常容易的事情，任何一個礦機都可以輕松完成。大家都可以輕松打包記錄的事情，作為獎勵的報酬給誰？這里就得來個“裁判”了，這里的“裁判”就是工作量證明（Proof Of Work，簡稱POW）

> #### 「大家來算一條數學題吧，誰先算出，打包權和獎勵金歸誰。」

### 加密算法、SHA256

$$
SHA256(Blockdata + RandomNounce) < 難度值
$$

SHA256算出來的長度就是**256bits**，也就是**32 Bytes**長。這是一個很長的數字範圍，難度值並不是一個很長的數字。而雜湊函數算出來的數值一般都視為亂數且無法預測的數值。

因此，產生合法的一個Block唯一的方法，就是大量代入不一樣的Rnadom Nonce數字，暴力法一直去試，直到**產生一個Block的SHA256 Hash值**小於**難度值。**

這樣的一個Block才會被P2P上的所有節點認可，當你產生這樣一個Block、其實我們就叫做挖到礦了。那個難度值會自動每個禮拜、**重新依照上週的平均產出速率**，去調出一個當初就設計好的速度，因此當越多人挖、這個值會自動調整出一個更難挖的、更小的難度值

關鍵字: Bitcoin、SHA256、POW

參考網站：[https://anders.com/blockchain/hash.html](https://anders.com/blockchain/hash.html)

## UTXO－錢不會無中生有

首先這邊有個場景是假如某個傢伙**”到處跟人借錢”**&**”到處告訴大家說他已付款”，**其實這兩種情形都差不多；而問題的癥結點會在「**如何避免有人花超過自己所擁有的實際金額**」。

那麼要解決這個問題，我們得回想起數位簽章的情形。首先，每筆交易內的資料內容都不同、所轉換出的數位簽章也不同。

而避免紀錄交易的順序發生混淆、每筆交易其實都有附帶自己的”**時間戳**”。所以排序好交易順序這件事情就沒有太大問題，最讓人頭疼的會是**”該如何避免某人重複花費?**”

也就是像這個情形: 甲不斷地提出交易記錄說、他一直支付出去就如同我們剛剛才提過的場景，所以為了解決這件事情得提到一個重要的概念”UTXO”帳本。

> **「大家的金流是在一個大型帳本內互相轉移貨幣、或者錢\(money\)」**

舉例來說，像這邊這張圖一樣 對於彭于晏來說他所持有的錢，等於過去所有人傳過給他的總和。由於過去兩筆資料的傳入、導致此時的他擁有5個BTC。當他打算將BTC傳送給對方時，傳送的資料會附帶他過去所收到的傳送歷史與資料序號。做數量的加總、以及記錄過  去的來源歷史導致杰倫收到帳的時候，可以根據過去的紀錄知道說「嗯，彭于晏真的擁有5個BTC，然後現在傳送給我了」

而這也是區塊鏈與比特幣**”最重要最重要的”核心概念，資料彼此是前後相關聯的。**這也是那篇比特幣論文最讓人讚嘆的特點之一，而間接的形成進一步的區塊鏈概念。

在比特幣這種加密貨幣的世界裡面，沒有所謂憑空而生、或是過度花費的貨幣\(Currency\)；原因就是因為貨幣\(Bitcoin\)的總量就是那麼固定。這也是為什麼比特幣並沒有完全匿名的功能與難以查驗與追蹤的原因。因為你每一”份額”、每一分所持有的BTC都是可以追溯它是從哪裡被挖出的、自哪一個礦池中被產出的。

#### 初始的BTC

這會跟我們後續會提到的礦工紀錄、與運算獎勵有關，來讓整個比特幣”池”的總額慢慢增加，直到最後的總量會卡在2100萬枚。總量的關係與等比級數的總和有關。不過別擔心，至於總量的限制與獎勵我們後面會提得更詳細。









